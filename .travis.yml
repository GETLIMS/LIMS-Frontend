language: node_js
node_js:
  - 'iojs'
  - '0.12'
  - '0.10'
sudo: required
services: docker
before_install:
  - git clone https://github.com/GETLIMS/LIMS-Backend.git
  - cd LIMS-Backend
  - git checkout ${TRAVIS_BRANCH:-dev}
  - docker build --no-cache -t getlims/backend .
  - docker run -d --name db postgres:latest
  - docker run -t --link db:db getlims/backend python manage.py migrate
  - docker run -t --link db:db getlims/backend python manage.py runscript create_superuser
  - docker run -p 8000:8000 --link db:db --name app -d getlims/backend
  - [[ $(curl -o /dev/null --silent --head --write-out '%{http_code}\n' http://localhost:8000/users/) == '401' ]]
  - cd ..
before_script:
  - npm install
  - npm install -g grunt-cli bower
  - bower install
  - gem install compass
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
